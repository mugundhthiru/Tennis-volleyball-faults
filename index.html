<!DOCTYPE html>
<html>
<head>
    <title>Ball Detection</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            transition: 0.4s;
            background: #101010;
            color: white;
            text-align: center;
        }

        #mainBox {
            padding: 20px;
            transition: 0.4s;
        }

        .img-row img {
            width: 120px;
            margin: 10px;
            border-radius: 10px;
            transition: 0.4s;
        }

        button {
            background: #444;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: 0.3s;
        }
        button:hover { background: #666; }

        /* THEMES */
        .tennis-theme {
            background: linear-gradient(#0f0, #060);
        }
        .volleyball-theme {
            background: linear-gradient(#008cff, #003e7a);
        }

        .tennis-img {
            border: 4px solid #00ff00;
        }

        .volleyball-img {
            border: 4px solid #009dff;
        }

    </style>
</head>
<body>

    <button onclick="goHome()">Home</button>
        <h1 id="modeStatus">Mode: Default</h1>

    <div id="mainBox">
        <div class="img-row" id="imageRow">
            <img id="img1" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Tennis_ball_01.jpg">
            <img id="img2" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Tennis_ball_01.jpg">
            <img id="img3" src="https://upload.wikimedia.org/wikipedia/commons/8/85/Tennis_ball_01.jpg">
        </div>

        <button onclick="setTennis()">Switch to Tennis Theme</button>
        <button onclick="setVolleyball()">Switch to Volleyball Theme</button>
        <br>
        <button onclick="startDetection()">Start Detection</button>
    </div>

    <div id="webcam-container"></div>
    <div id="label-container"></div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
<script>
    let lastTheme = "default";

    const tennisImages = [
        "https://upload.wikimedia.org/wikipedia/commons/8/85/Tennis_ball_01.jpg",
        "https://upload.wikimedia.org/wikipedia/commons/8/85/Tennis_ball_01.jpg",
        "https://upload.wikimedia.org/wikipedia/commons/8/85/Tennis_ball_01.jpg"
    ];

    const volleyballImages = [
        "https://upload.wikimedia.org/wikipedia/commons/7/7e/Volleyball_%28International%29.png",
        "https://upload.wikimedia.org/wikipedia/commons/7/7e/Volleyball_%28International%29.png",
        "https://upload.wikimedia.org/wikipedia/commons/7/7e/Volleyball_%28International%29.png"
    ];

    const originalImages = [...tennisImages];

    function setTennis() {
        document.body.className = "tennis-theme";
        lastTheme = "tennis";
        document.getElementById("modeStatus").textContent = "Mode: Tennis";

        document.querySelectorAll('.img-row img').forEach((img, i) => {
            img.src = tennisImages[i];
            img.className = "tennis-img";
        });
    }

    function setVolleyball() {
        document.body.className = "volleyball-theme";
        lastTheme = "volleyball";
        document.getElementById("modeStatus").textContent = "Mode: Volleyball";

        document.querySelectorAll('.img-row img').forEach((img, i) => {
            img.src = volleyballImages[i];
            img.className = "volleyball-img";
        });
    }

    /* LOAD AI MODEL + SWITCH TO ORIGINAL DETECTION SCREEN */

    const URL = "./my_model/";
    let model, webcam, labelContainer, maxPredictions;

    function goHome() {
        // Reset to main screen
        document.getElementById('mainBox').style.display = 'block';
        document.getElementById('webcam-container').innerHTML = '';
        document.getElementById('label-container').innerHTML = '';
        if (webcam) webcam.stop();
    }

    async function startDetection() {
        document.getElementById("mainBox").style.display = "none";

        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        const flip = true;
        webcam = new tmImage.Webcam(300, 300, flip);
        await webcam.setup();
        await webcam.play();
        window.requestAnimationFrame(loop);

        document.getElementById("webcam-container").appendChild(webcam.canvas);
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) {
            labelContainer.appendChild(document.createElement("div"));
        }
    }

    async function loop() {
        webcam.update();
        await predict();
        window.requestAnimationFrame(loop);
    }

    async function predict() {
        const prediction = await model.predict(webcam.canvas);
        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
                prediction[i].className + ": " + prediction[i].probability.toFixed(2);
            labelContainer.childNodes[i].innerHTML = classPrediction;
        }
    }
</script>

</body>
</html>
